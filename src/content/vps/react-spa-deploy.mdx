# React SPA Deployment — VPS + NGINX + HTTPS + GitHub Actions

This guide builds and deploys a **React** single-page application (SPA) to a **Linux VPS**, configures **NGINX** for client-side routing, enables **HTTPS** via **Certbot**, sets **Aruba DNS**, and wires **CI/CD** via **GitHub Actions**.

## Recommended vps structure

~~~
/srv/www/
├── react-apps/
│   └── my-react-app/
│       └── build/          ← Generated by `npm run build`
├── logs/
│   └── my-react-app/
│       ├── access.log
│       └── error.log
├── configs/
    └── nginx/
        └── my-react-app.conf
~~~

## Prerequisites

- Linux VPS (Ubuntu/Debian) with public IP
- Non-root user with `sudo` (e.g., `<deploy-user>`)
- React app in GitHub (CRA/Vite/other SPA; **not SSR**)
- Domain or subdomain on Aruba (e.g., `app.example.com`)

## Prepare the vps node nginx firewall

~~~bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y nginx git curl ufw

# Node.js LTS (example: Node 20)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Firewall
sudo ufw allow OpenSSH
sudo ufw allow 'Nginx Full'
sudo ufw --force enable
sudo ufw status
~~~

Create base directories:

~~~bash
sudo mkdir -p /srv/www/react-apps/<app-name>/build
sudo mkdir -p /srv/www/logs/<app-name>
sudo mkdir -p /srv/www/configs/nginx
~~~

## Clone and build the react app

~~~bash
cd /srv/www/react-apps/<app-name>
sudo git clone https://github.com/<your-user>/<repo>.git .
sudo npm ci
sudo npm run build
~~~

Result: production assets in `/srv/www/react-apps/<app-name>/build`.

## Configure nginx for spa routing

Create `/srv/www/configs/nginx/<app-name>.conf`:

~~~nginx
server {
    listen 80;
    server_name <domain>;  # e.g. app.example.com

    root /srv/www/react-apps/<app-name>/build;
    index index.html;

    access_log /srv/www/logs/<app-name>/access.log;
    error_log  /srv/www/logs/<app-name>/error.log;

    # SPA routing: fallback to index.html
    location / {
        try_files $uri /index.html;
    }
}
~~~

Enable and reload:

~~~bash
sudo ln -s /srv/www/configs/nginx/<app-name>.conf /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
~~~

## Point dns on aruba

Add **A** record:

| Type | Host (Name) | Value (IP) |
|-----:|--------------|------------|
|  A   | `app`        | `<VPS-IP>` |

Result: `app.yourdomain.com` → `<VPS-IP>`.

## Enable https with certbot

~~~bash
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d <domain>   # e.g. -d app.example.com
~~~

## Fix permissions

~~~bash
sudo chown -R www-data:www-data /srv/www/react-apps/<app-name>/build
sudo chmod -R 755 /srv/www/react-apps/<app-name>/build
~~~

## All in one deploy script

Create `deploy-react-app.sh` (store on VPS or `~/scripts`):

~~~bash
#!/bin/bash
set -euo pipefail

if [[ $# -ne 3 ]]; then
  echo "Usage: $0 <project-name> <github-repo-url> <domain>"
  echo "Example: $0 my-react-app https://github.com/you/repo.git app.example.com"
  exit 1
fi

PROJECT_NAME="$1"
REPO_URL="$2"
DOMAIN="$3"

ROOT_DIR="/srv/www/react-apps/$PROJECT_NAME"
BUILD_DIR="$ROOT_DIR/build"
LOG_DIR="/srv/www/logs/$PROJECT_NAME"
CONF_DIR="/srv/www/configs/nginx"
CONF_FILE="$CONF_DIR/$PROJECT_NAME.conf"

echo "Creating folders..."
sudo mkdir -p "$ROOT_DIR" "$BUILD_DIR" "$LOG_DIR" "$CONF_DIR"

echo "Cloning/updating repository..."
cd "$ROOT_DIR"
if [[ ! -d .git ]]; then
  sudo git clone "$REPO_URL" .
else
  sudo git pull --ff-only
fi

echo "Installing & building..."
sudo npm ci
sudo npm run build

echo "Permissions..."
sudo chown -R www-data:www-data "$BUILD_DIR"
sudo chmod -R 755 "$BUILD_DIR"

echo "Writing NGINX config..."
sudo tee "$CONF_FILE" >/dev/null <<EOF
server {
    listen 80;
    server_name $DOMAIN;

    root $BUILD_DIR;
    index index.html;

    access_log $LOG_DIR/access.log;
    error_log  $LOG_DIR/error.log;

    location / { try_files \$uri /index.html; }
}
EOF

echo "Enable & reload NGINX..."
sudo ln -sf "$CONF_FILE" /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx

read -p "Enable HTTPS with Certbot for $DOMAIN? (y/n): " R
[[ "$R" =~ ^[Yy]$ ]] && sudo certbot --nginx -d "$DOMAIN" || echo "HTTPS not enabled."

echo "✅ React app deployed: https://$DOMAIN"
~~~

Make it executable:

~~~bash
chmod +x deploy-react-app.sh
~~~

## Build on the vps

**Generate a deploy SSH key (local):**

~~~bash
ssh-keygen -t rsa -b 4096 -C "github-deploy" -f ~/.ssh/id_rsa_github -N ""
ssh-copy-id -i ~/.ssh/id_rsa_github.pub <deploy-user>@<VPS-IP>
~~~

**GitHub repository secrets:**

- `SSH_PRIVATE_KEY` → content of `~/.ssh/id_rsa_github`
- `VPS_HOST` → `<VPS-IP>`
- `VPS_USER` → `<deploy-user>`

**Workflow** `.github/workflows/deploy.yml`:

~~~yaml
name: Deploy React (build on VPS)
on:
  push:
    branches: [ main ]
concurrency: deploy-react
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build & deploy on VPS
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            set -e
            cd /srv/www/react-apps/<app-name>
            git pull origin main
            npm ci
            npm run build
            chown -R www-data:www-data build
            systemctl reload nginx
~~~

**Pros:** minimal setup. **Cons:** build depends on VPS toolchain.

## Build in ci upload artifacts

**Same SSH key + secrets as above.**

**Workflow** `.github/workflows/deploy.yml`:

~~~yaml
name: Deploy React (build in CI)
on:
  push:
    branches: [ main ]
concurrency: deploy-react
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm ci
      - run: npm run build

      - name: Tar build
        run: tar -czf build.tgz -C build .

      - name: Upload build.tgz to VPS
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          source: build.tgz
          target: /srv/www/react-apps/<app-name>/

      - name: Unpack, release swap, reload NGINX
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            set -e
            cd /srv/www/react-apps/<app-name>
            mkdir -p releases
            TS=$(date +%Y%m%d%H%M%S)
            mkdir "releases/$TS"
            tar -xzf build.tgz -C "releases/$TS"
            ln -sfn "releases/$TS" build
            chown -R www-data:www-data "releases/$TS" build
            systemctl reload nginx
~~~

**Rollback (with releases):**
~~~bash
cd /srv/www/react-apps/<app-name>
ls -1 releases
ln -sfn releases/<previous-timestamp> build
systemctl reload nginx
~~~

## Optional nginx enhancements

**http to https redirect**
~~~nginx
server {
  listen 80;
  server_name <domain>;
  return 301 https://$host$request_uri;
}
~~~

**Static asset caching and gzip**
~~~nginx
gzip on;
gzip_types text/plain text/css application/javascript application/json image/svg+xml;
location ~* \.(js|css|png|jpg|svg|woff2?)$ { expires 30d; access_log off; }
~~~

## Troubleshooting

| Symptom                               | Likely cause and fix                                         |
|--------------------------------------|---------------------------------------------------------------|
| Refresh on nested routes returns 404 | Missing SPA fallback: `try_files $uri /index.html;`          |
| Certbot fails with NXDOMAIN          | Wrong or absent DNS record at Aruba; wait for propagation    |
| Actions step fails ssh               | Wrong secrets, SSH port blocked, key not in `authorized_keys`|
| White page after deploy              | Build failed or wrong `root` path in NGINX config            |